
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visitor Form - Shri Swami Samarth Gurupeeth</title>
  <script>
    async function checkPhone() {
      const phone = document.getElementById("phone").value;
      if (!phone) return;

      const res = await fetch(`https://script.google.com/macros/s/AKfycbxNqtCnhAuhFh73AAfYXTkBgUdm_a4VPFU54CSJhtjUwTwGkxpXaZuKls5RlDh4f12I/exec?phone=${phone}`);
      const data = await res.json();

      const regDiv = document.getElementById("regFields");
      const msg = document.getElementById("msg");
      const submitBtn = document.getElementById("submitBtn");

      if (data.exists) {
        msg.innerText = "üôè Thank you for your visit! Your darshan has been recorded.";
        regDiv.style.display = "none";
        submitBtn.style.display = "none";
      } else {
        regDiv.style.display = "block";
        submitBtn.style.display = "inline";
        msg.innerText = "";
      }
    }

    async function submitForm(e) {
      e.preventDefault();
      const form = document.getElementById("visitForm");
      const formData = new FormData(form);
      const params = new URLSearchParams(formData);
      const res = await fetch('https://script.google.com/macros/s/AKfycbxNqtCnhAuhFh73AAfYXTkBgUdm_a4VPFU54CSJhtjUwTwGkxpXaZuKls5RlDh4f12I/exec', {
        method: 'POST',
        body: params
      });
      const data = await res.json();
      document.getElementById("msg").innerText = data.message || 'Submitted!';
      form.reset();
    }
  </script>
</head>
<body>
  <h2>üôè Akhil Bhartiya Shri Swami Samarth Gurupeeth Dattadham, Shri Kshetra Nrusinhwadi üôè</h2>

  <form id="visitForm" onsubmit="submitForm(event)">
    <label>Mobile Number (‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ - WhatsApp):<br>
      <input type="tel" id="phone" name="phone" required onblur="checkPhone()">
    </label><br><br>

    <div id="regFields" style="display:none;">
      <label>Full Name (‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ):<br><input type="text" name="name" required></label><br><br>
      <label>Address (‡§™‡§§‡•ç‡§§‡§æ):<br><input type="text" name="address" required></label><br><br>
      <label>‡§ú‡§®‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§≤‡•á‡§≤‡§æ ‡§Ü‡§π‡•á ‡§ï‡§æ?:<br>
        <select name="jankalyan">
          <option value="Yes">‡§π‡•ã‡§Ø (Yes)</option>
          <option value="No">‡§®‡§æ‡§π‡•Ä (No)</option>
        </select>
      </label><br><br>
    </div>

    <button id="submitBtn" type="submit" style="display:none;">Submit</button>
  </form>

  <p id="msg"></p>
</body>
</html>
